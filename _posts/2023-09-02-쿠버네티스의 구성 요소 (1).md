쿠버네티스의 구성 요소 (1)
================

### 컴포넌트

*   API server
    
    *   클러스터의 API를 사용할 수 있게 해주는 프로세스로, 클러스터로 요청이 들어왔을 때 그 요청이 유효한 지 검증하는 역할
    
    *   사용자가 보낸 명령어를 검증하고 유효성을 검사 후 워커노드에 파드 생성하도록 명령을 전송

*   etcd
    
    *   클러스터에 필요한 정보, 파드와 같은 리소스들의 상태 정보를 저장하는 곳으로, key-value 형태를 저장
    
    *   API 서버는 파드를 만든다는 사실을 etcd에 알리고 사용자에게 파드 생성 되었음을 알리는데 아직 파드가 생성되지는 않음

*   scheduler
    
    *   API 서버가 etcd에게 파드 생성 여부를 알리고 실제 어떤 워크 노드에 파드 생성할지 결정하는 컴포넌트
    
    *   어떤 노드에 파드 생성할 지 API 서버에게 알림

*   kubelet
    
    *   API 서버는 스케쥴러로부터 어떤 워커노드에 파드 생성해야 할 지 통보받고 그 워커노드의 kubelet에게 파드의 생성 정보를 전달해서 파드를 생성하도록 함
    
    *   kubelet은 파드를 생성하고 그 정보를 API 서버에 전달하고 API 서버는 파드의 상태를 etcd에 전달

*   controller manager
    
    *   kube-controller manager
        
        *   컴포넌트들의 상태를 지속적으로 모니터링하고 실행 상태를 유지하는 역할
        
        *   파드의 상태가 이상하거나 워커 노드의 상태가 이상하면 해당 노드를 제거하고 다른 워커노드에 파드 생성
    
    *   cloud-controller manager
        *   퍼블릭 클라우드에서 제공하는 컴포넌트로 실제 쿠버네티스와 연동되는 서비스들을 관리

*   Proxy
    
    *   kube proxy는 클러스터의 모든 노드에서 실행되는 네트워크의 프록시
    
    *   노드에 대한 네트워크 규칙 관리

*   Container runtime
    
    *   실제 컨테이너를 실행시키는 컴포넌트
    
    *   도커가 많이 사용되었는데 1.2 버전부터는 컨테이너디니 크라이오를 사용하는 것을 권장

### 쿠버네티스 컨트롤러

*   파드 관리

*   종류
    
    *   daemon set
        
        *   디플로이먼트처럼 파드 생성하고 관리하는 컨트롤러
        
        *   특정 노드 또한 모든 노드에 파드 생성
        
        *   taint: 특정 워커노드에 특정 성격의 파드만 배포하고자 할 때 설정하는 것
            *   ex) 특정 앱 구동 파드는 GPU 있는 노드에만 배치
        
        *   toleration: taint 설정된 노드에는 일반 파드는 배포될 수 없으나 이를 적용 시 배포 가능
    
    *   deployment
        
        *   상태 없는 앱 배포 컨트롤러
        
        *   레플리카 셋의 상위 개념
        
        *   YAML 파일로 만들어 배포
    
    *   replica set
        *   몇개의 파드 유지할 지 결정하는 컨트롤러
    
    *   stateful set
        
        *   상태를 가진 파드 배포에 사용
        
        *   파드의 순서 및 고유성 보장
    
    *   cron job
        
        *   지정한 일정에 따라 잡 실행에 사용
        
        *   데이터 백업이나 일정 주기 데이터 수집에 사용
    
    *   job
        
        *   하나 이상의 파드를 지정하고 성공적으로 실행되도록 해주는 컨트롤러
        
        *   파드가 비정상적으로 작동하면 다른 노드에서 파드 시작
    
    *   replication, controller

### 쿠버네티스의 서비스

*   동일한 구성을 갖는 파드들을 모아 놓은 것

*   여러개의 워커 노드에 존재하더라도 동일 구성 갖는 파드라면 하나의 서비스가 관리

*   컨테이너는 한번 도커 엔진에 만들어지면 이동 X, 파드는 다른 워커 노드로 이동 가능하므로 외부 직접 연결 어려움

*   서비스가 일종의 고정 IP를 가지고 외부에서 파드를 사용 가능케 함

*   load balancer 역할도 수행

*   내부적으로는 여러 파드가 있어도 밖에서는 하나의 IP(서비스 IP) 주소만 노출

*   서비스 IP 종류
    
    *   Cluster IP
        *   파드들이 내부에서 서로 통신위해 부여된 IP
    
    *   NodePort
        *   서비스 외부로 노출 시 사용하는 IP와 Port
    
    *   Load Balancer IP
        *   퍼블릭 클라우드 로드 밸런서에 연결 시 사용

*   서비스 분배 통신은 하나의 워커 노드로 국한, 여러 워커 노드 간 분배는 로드 밸런서나 인그레스가 담당
    
    [![](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%E1%84%8B%E1%85%B4%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%AD%E1%84%89%E1%85%A9%20(1)%208e7add027da44c60bce015b7834a49d3/Untitled.png)](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%E1%84%8B%E1%85%B4%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8B%E1%85%AD%E1%84%89%E1%85%A9%20(1)%208e7add027da44c60bce015b7834a49d3/Untitled.png)
    

### 쿠버네티스의 통신

*   파드 사용 네트워크와 노드(호스트)의 네트워크는 다름
    *   파드는 가상의 네트워크(vetho0), 노드(etho0)는 실제 네트워크

*   기본적으로 동일 노드에 있는 파드끼리만 통신 가능

*   다른 노드의 파드와 통신을 하려면 CNI 플러그인이나 서비스 이용

*   Ingress(인그레스)
    
    *   클러스터 외부에서 내부 접근 요청 어떻게 처리할 지 정의한 규칙의 모음
    
    *   클러스터 외부에서 URL로 접근할 수 있도록 해주는 로드 밸런싱, SSL 인증서 처리 등의 규칙을 정의

### 오브젝트와 인스턴스

*   오브젝트는 파드, 서비스, 레플리카, 디플로이먼트 등을 의미하고 이를 이용해 실제 etcd에 등록되면 인스턴스라 함