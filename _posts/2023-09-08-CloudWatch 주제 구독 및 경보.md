Cloud Watch에서 주제-구독 설정 후 경보 보내기
===============================

Cloud Watch
-----------

*   리소스와 앱 실시간 모니터링 서비스

*   로그
    
    *   앱의 리소스 로그를 그룹 단위로 기록
    
    *   CSV로 다운 가능하고 S3에 저장 가능

*   지표
    *   그래프 형태로 출력

*   대시보드
    *   여러 지표를 하나의 화면에 출력

*   종류
    
    *   기본: 5분
    
    *   상세: 1분

*   장점
    
    *   서버 과부하 문제 해결
    
    *   비용 절감 효과 - 사용자에게 알림 제공

실습
--

*   EC2 인스턴스 만들기

*   putty 접속

*   컴퓨터에 용량 큰 파일 다운
    *   [https://www.jetbrains.com/datagrip/download에서](https://www.jetbrains.com/datagrip/download에서) 다운로드

*   EC2 서버에 파일 전송 (local → EC2)
    
    *   pscp -i ppk 경로 전송할 파일 경로 ubuntu@서버IP:전송할경로
    
    *   pscp -i C:\\Users\\USER\\Downloads\\eunhakey.ppk C:\\Users\\USER\\Downloads\\MLOps.pdf [ubuntu@54.198.226.156](mailto:ubuntu@54.198.226.156):

*   putty에서 해당 파일 확인 가능
    
    [![](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled.png)](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled.png)
    

*   인스턴스 모니터링 확인 가능
    
    [![](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%201.png)](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%201.png)
    

*   Cloud Watch에서도 확인 가능
    
    [![](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%202.png)](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%202.png)
    

*   파일 업로드 기록은 EBS에서 확인 가능
    
    [![](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%203.png)](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%203.png)
    

EC2 인스턴스에서 경고 만들기
=================

*   CPU 사용량이 70%넘는 경우 이메일로 알림 주기

### 1\. 토픽 주제 선정 - 구독 서비스 생성

*   SQS - 구독과 게시

*   SNS - 이메일, 문자 서비스
    
    *   구독만 가능
    
    *   주제 선정은 SNS에서

*   SNS (Simple Notification Service)에서 주제 생성하기
    
    [![](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%204.png)](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%204.png)
    

*   주제 안에서 구독 생성
    
    [![](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%205.png)](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%205.png)
    

*   이메일에서 구독을 confirm
    
    [![](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%206.png)](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%206.png)
    

### 2\. CloudWatch에서 경보 설정

*   scail up/down 등 조절 가능

*   CloudWatch>경보>경보 생성

*   지표 및 조건 지정
    
    *   EC2> 인스턴스별 지표 > 지표 선택> CPUUtilization
        
        [![](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%207.png)](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%207.png)
        
    
    *   조건 설정
        
        [![](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%208.png)](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%208.png)
        

*   작업 구성
    *   알림 설정 (만들어 둔 주제 선택)
        
        [![](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%209.png)](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%209.png)
        

*   CPU에 stress 가하기
    
    *   stress 설치
        
        *   sudo apt-get update
        
        *   sudo apt-get install stress
    
    *   cpu 확인
        *   grep -c processor /proc/cpuinfo
    
    *   코어 수 1인 경우 스트레스 주기
        *   stress -c 2

*   경보 메일 확인 가능
    
    [![](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%2010.png)](Cloud%20Watch%E1%84%8B%E1%85%A6%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%AE%E1%84%8C%E1%85%A6-%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%92%E1%85%AE%20%E1%84%80%E1%85%A7%E1%86%BC%E1%84%87%E1%85%A9%20%E1%84%87%E1%85%A9%E1%84%82%E1%85%A2%E1%84%80%E1%85%B5%2003d63ee7a0514d819ec2bef79b8dc42e/Untitled%2010.png)